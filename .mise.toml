[env]
_.python.venv = { path = ".venv", create = false }

[settings]
experimental = true

[tools]
"jq" = "latest"
"npm:cwebp-bin" = "latest"
prettier = "latest"
rye = "latest"
taplo = "latest"

[tasks.serve]
description = "Serve the site locally with Quartz"
run = """
#!/usr/bin/env bash
if [ ! -d ".quartz" ]; then
  echo "Cloning Quartz..."
  git clone --depth 1 https://github.com/jackyzha0/quartz.git .quartz
  cd .quartz && npm ci && cd ..
fi
rm -rf .quartz/content
cp -r src .quartz/content
cp quartz.config.ts .quartz/quartz.config.ts
cp quartz.layout.ts .quartz/quartz.layout.ts
cd .quartz && npx quartz build --serve
"""

[tasks."format:check"]
description = "Format files"
run = ["prettier --check ." , "taplo format --check"]

[tasks."format:fix"]
description = "Format files"
run = ["prettier --write .", "taplo format"]

[tasks."recipe-scrapers:install"]
description = "Installs recipe-scrapers via rye"
run = """
#!/usr/bin/env bash
curl -sSf https://rye.astral.sh/get | RYE_INSTALL_OPTION="--yes" bash
source "$HOME/.rye/env"
rye sync -f
"""

[tasks."migrate:dryrun"]
description = "Dry run recipe migration to Obsidian format"
run = ".venv/bin/python migrate_to_obsidian.py --dry-run -v"

[tasks."migrate:execute"]
description = "Execute recipe migration to Obsidian format"
run = ".venv/bin/python migrate_to_obsidian.py -v"
